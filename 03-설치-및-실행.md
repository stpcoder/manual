# 제3장 설치 및 실행

## 3.1 시스템 요구사항

### 3.1.1 하드웨어 요구사항

| 항목 | 최소 사양 | 권장 사양 |
|------|----------|----------|
| 프로세서 | 듀얼 코어 이상 | 쿼드 코어 이상 |
| 메모리(RAM) | 4 GB | 8 GB 이상 |
| 저장 공간 | 500 MB (설치) | 2 GB 이상 (결과 파일 포함) |
| 디스플레이 | 1280 x 720 | 1920 x 1080 이상 |

### 3.1.2 소프트웨어 요구사항

| 항목 | 최소 버전 | 권장 버전 |
|------|----------|----------|
| Python | 3.8 | 3.11 이상 |
| 운영체제 | Windows 10 | Windows 10/11 |

본 시스템은 macOS 및 Linux에서도 동작이 가능하나, 주요 테스트는 Windows 환경에서 수행되었습니다.

## 3.2 설치 절차

### 3.2.1 저장소 복제

```bash
git clone https://github.com/LimJih00n/Recognition_of_damaged_areas_in_ancient_documents.git
cd Recognition_of_damaged_areas_in_ancient_documents
```

### 3.2.2 가상환경 생성 및 활성화

Windows 환경:
```bash
python -m venv venv
venv\Scripts\activate
```

macOS/Linux 환경:
```bash
python -m venv venv
source venv/bin/activate
```

### 3.2.3 의존성 패키지 설치

```bash
pip install -r requirements.txt
```

### 3.2.4 의존성 패키지 목록

본 시스템이 요구하는 주요 의존성 패키지는 다음과 같습니다.

| 패키지 | 최소 버전 | 용도 |
|--------|----------|------|
| PyQt6 | 6.5.0 | GUI 프레임워크 |
| opencv-python-headless | 4.12.0 | 이미지 처리 |
| Pillow | 12.0.0 | 이미지 입출력 |
| scikit-image | 0.25.2 | 영상 처리 보조 |
| NumPy | 2.2.6 | 수치 배열 연산 |
| SciPy | 1.16.2 | 과학 계산, 통계 |
| Shapely | 2.0.0 | 폴리곤 기하 연산 |
| svgpathtools | 1.6.1 | SVG 경로 파싱 |
| pyclipper | 1.3.0 | 폴리곤 클리핑 |
| Matplotlib | 3.10.7 | 시각화 |

다음 패키지는 선택적(optional)이며, 딥러닝 기반 기능 사용 시에만 필요합니다.

| 패키지 | 최소 버전 | 용도 |
|--------|----------|------|
| torch | 2.9.0 | 딥러닝 프레임워크 |
| torchvision | 0.24.0 | 영상 처리용 딥러닝 |
| kornia | 0.8.1 | 미분 가능 영상 처리 |
| h5py | 3.15.1 | HDF5 데이터 입출력 |

## 3.3 GUI 실행

### 3.3.1 기본 실행

```bash
cd gui_app/src
python main.py
```

실행 시 PyQt6 기반의 그래픽 사용자 인터페이스가 나타나며, 다크 테마가 자동으로 적용됩니다.

### 3.3.2 실행 흐름

main.py의 실행 흐름은 다음과 같습니다.

1. QApplication 인스턴스를 생성합니다.
2. 다크 테마 스타일시트를 적용합니다(theme.py의 apply_theme 호출).
3. MainWindow 인스턴스를 생성하고 표시합니다.
4. 이벤트 루프를 시작합니다.

## 3.4 CLI 실행

### 3.4.1 기본 실행

GUI 없이 명령줄에서 전체 파이프라인을 실행할 수 있습니다.

```bash
python main/restoration_workflow.py \
  --input "입력이미지경로.tif" \
  --output-dir "결과저장폴더경로"
```

### 3.4.2 매개변수 지정 실행

```bash
python main/restoration_workflow.py \
  --input "datasets/document.tif" \
  --output-dir "results/output" \
  --threshold 138 \
  --min-area 50 \
  --max-area 2500000 \
  --paper-size A4
```

CLI 옵션의 상세 설명은 제6장 CLI 사용법을 참조하시기 바랍니다.

## 3.5 Windows 실행 파일 빌드

### 3.5.1 PyInstaller를 이용한 빌드

```bash
pyinstaller build_exe.spec
```

### 3.5.2 빌드 결과물

빌드가 완료되면 다음 경로에 실행 파일이 생성됩니다.

```
dist/HoleDetection/HoleDetection.exe
```

### 3.5.3 빌드 설정 상세

build_exe.spec 파일의 주요 설정은 다음과 같습니다.

| 항목 | 설정값 | 설명 |
|------|--------|------|
| 진입점 | gui_app/src/main.py | 애플리케이션 시작 파일 |
| 포함 데이터 | main/ 폴더 전체 | 알고리즘 모듈 |
| Hidden imports | cv2, numpy, PyQt6, shapely, scipy.ndimage | 동적 임포트 모듈 |
| 제외 항목 | torch, tensorflow, sklearn, tkinter | 불필요 라이브러리 |
| 출력 경로 | dist/HoleDetection/ | 실행 파일 디렉토리 |

### 3.5.4 빌드 실행 파일 사용

빌드된 실행 파일은 Python 환경이 설치되지 않은 시스템에서도 독립적으로 실행이 가능합니다. dist/HoleDetection/ 디렉토리 전체를 배포 대상 시스템에 복사한 후 HoleDetection.exe를 실행합니다.

## 3.6 설치 확인

설치가 정상적으로 완료되었는지 확인하기 위해 다음을 수행합니다.

1. GUI 실행 후 이미지를 드래그 앤 드롭하여 로드가 정상적으로 이루어지는지 확인합니다.
2. "Apply Filter" 버튼을 클릭하여 검출이 수행되는지 확인합니다.
3. "Layout" 탭으로 전환하여 레이아웃이 표시되는지 확인합니다.

상기 과정에서 오류가 발생하는 경우, 의존성 패키지의 버전 호환성을 점검합니다.

## 3.7 알려진 설치 관련 주의사항

### 3.7.1 한글 경로

프로젝트 디렉토리 및 이미지 파일의 경로에 한글이 포함된 경우 일부 기능에서 오류가 발생할 수 있습니다. 가능한 한 영문 경로를 사용할 것을 권장합니다.

### 3.7.2 PyQt6 호환성

일부 Linux 배포판에서는 PyQt6의 시스템 의존성(libGL, libEGL 등)이 추가로 필요할 수 있습니다. 해당 환경에서는 배포판의 패키지 관리자를 통해 필요 라이브러리를 설치합니다.
