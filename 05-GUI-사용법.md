# 제5장 GUI 사용법

## 5.1 애플리케이션 실행

### 5.1.1 실행 명령

본 시스템의 GUI 애플리케이션은 다음의 명령으로 실행합니다.

```bash
cd gui_app/src
python main.py
```

### 5.1.2 실행 시 초기화 과정

실행 시 다음의 과정이 순차적으로 수행됩니다.

1. QApplication 인스턴스를 생성하고, High DPI 스케일링 정책을 PassThrough로 설정합니다.
2. 애플리케이션 명칭을 "Hole Detection"으로 지정합니다.
3. 다크 테마 스타일시트를 적용합니다(theme.py의 apply_theme 함수 호출).
4. MainWindow 인스턴스를 생성하고, 최대화 상태(showMaximized)로 표시합니다.
5. PyQt6 이벤트 루프를 시작합니다.

### 5.1.3 다크 테마

본 시스템은 실행 시 다크 테마가 자동으로 적용됩니다. 배경색은 #1E1E1E(짙은 회색), 텍스트 색상은 #D4D4D4(밝은 회색), 액센트 색상은 #0E639C(파란색)을 기본으로 사용합니다. 별도의 테마 전환 기능은 제공하지 않습니다.

---

## 5.2 사용자 인터페이스 개요

### 5.2.1 전체 레이아웃 구조

MainWindow는 다음의 세 영역으로 구성됩니다.

| 영역 | 위치 | 설명 |
|------|------|------|
| ControlPanel | 좌측 사이드바 | 고정 너비 280px, 모든 조작 컨트롤을 포함합니다 |
| TabWidget | 우측 메인 영역 | "Detection" 및 "Layout" 두 개의 탭으로 구성됩니다 |
| StatusBar | 하단 | 현재 작업 상태 및 검출 결과 요약을 표시합니다 |

좌측 ControlPanel과 우측 TabWidget은 QSplitter를 통해 수평 분할되며, ControlPanel의 너비는 280px로 고정되고 우측 영역이 창 크기 변경 시 자동으로 확장됩니다. 창의 최소 크기는 1200 x 800 픽셀로 설정되어 있습니다.

### 5.2.2 좌측 사이드바 (ControlPanel)

ControlPanel은 스크롤 가능한 영역 내에 다음의 그룹을 상단부터 순서대로 배치합니다.

1. **Image** -- 이미지 드래그 앤 드롭 영역 (ImageDropZone)
2. **Auto Filter Detection** -- 배경/전경 영역 선택 및 자동 분석 (RegionSelector)
3. **Filter Settings** -- 모델 상태 표시 및 필터 적용 버튼 (FilterPanel)
4. **Noise Filter** -- 최소/최대 면적 필터, 경계 검출 토글, 영역 해제 (AreaSelector)
5. **Save Results** 버튼
6. **Status** 표시 프레임 -- 검출 결과 수량 표시 ("Holes: N | Active: M")

### 5.2.3 우측 탭 영역

우측 영역은 QTabWidget으로 구성되며, 두 개의 탭을 포함합니다.

**Detection 탭**: 검출 결과를 시각적으로 확인하는 메인 작업 영역입니다. 상단에 검색 바(Find piece 입력란, Go 버튼, Re-number 버튼, Fit 버튼)가 위치하며, 그 아래에 SVGOverlayViewer가 원본 이미지 위에 검출된 손상 부위의 SVG 윤곽선을 오버레이하여 표시합니다.

**Layout 탭**: 커팅 레이아웃을 시각화하는 영역입니다. 상단에 용지 크기, 스케일, 테두리 등의 설정 컨트롤이 배치되며, 그 아래에 실제 레이아웃 미리보기가 표시됩니다.

### 5.2.4 상태 바

MainWindow 하단의 상태 바는 현재 수행 중인 작업의 진행 상황, 검출 결과 수량("Detected N holes | Active: M"), 오류 메시지 등을 실시간으로 표시합니다.

---

## 5.3 이미지 로딩

### 5.3.1 드래그 앤 드롭 방식

좌측 ControlPanel 상단의 "Image" 그룹 내 ImageDropZone 영역에 이미지 파일을 마우스로 끌어다 놓으면(drag and drop) 이미지가 자동으로 로드됩니다. 드래그 진입 시 영역의 테두리 색상이 파란색(#0E639C)으로 변경되어 드롭 가능 상태임을 시각적으로 표시합니다.

### 5.3.2 파일 대화상자 방식

ImageDropZone 영역을 마우스로 클릭하면 파일 선택 대화상자가 나타납니다. 또는 메뉴 바의 File > Open Image(단축키: Ctrl+O)를 선택하여 파일 대화상자를 열 수 있습니다.

### 5.3.3 지원 이미지 형식

본 시스템이 지원하는 이미지 형식은 다음과 같습니다.

| 형식 | 확장자 | 비고 |
|------|--------|------|
| TIFF | .tif, .tiff | 고해상도 스캔 이미지에 최적화되어 있습니다 |
| PNG | .png | 무손실 압축입니다 |
| JPEG | .jpg, .jpeg | 손실 압축입니다 |
| BMP | .bmp | 비압축 비트맵입니다 |

### 5.3.4 이미지 로드 후 자동 처리

이미지 로드 시 다음의 처리가 자동으로 수행됩니다.

1. 기존의 모든 검출 상태(검출 결과, SVG 경로, 활성 상태, 영역 선택, GMM 모델)가 초기화됩니다.
2. Detection 탭으로 자동 전환됩니다.
3. 로딩 오버레이("Loading image...")가 표시됩니다.
4. SVGOverlayViewer에 이미지가 로드됩니다.
5. 구멍 색상 자동 추출(auto_extract_color)이 실행됩니다.
6. 로딩 완료 후 상태 바에 파일명이 표시됩니다.

---

## 5.4 자동 필터 워크플로우 (권장)

본 절에서는 GMM(Gaussian Mixture Model) 기반 Mahalanobis 거리 분류를 활용한 자동 필터 워크플로우를 기술합니다. 이 방식은 사용자가 소수의 표본 영역만 지정하면 시스템이 색 분포를 자동으로 학습하여 분류하므로, 수동 필터 조정 대비 높은 정밀도를 달성할 수 있습니다.

### 5.4.1 절차 개요

자동 필터 워크플로우는 다음의 6단계로 구성됩니다.

### 5.4.2 1단계: 이미지 로드

제5.3절에 기술된 방법에 따라 대상 한국화 스캔 이미지를 로드합니다.

### 5.4.3 2단계: 구멍 영역 선택

좌측 ControlPanel의 "Auto Filter Detection" 그룹에서 "Select Hole Region" 버튼을 클릭합니다. 버튼이 활성 상태(녹색 강조)로 전환되며, 상태 바에 "Drag to select hole regions (green) - click button again to stop" 메시지가 표시됩니다.

Detection 탭의 이미지 위에서 마우스를 드래그하여 구멍이 포함된 영역을 사각형으로 선택합니다. 선택된 영역은 녹색 사각형으로 표시됩니다. 하나의 영역 선택이 완료되면 즉시 다음 영역을 선택할 수 있으며, 다수의 영역을 연속적으로 지정하는 것이 가능합니다. 한국화 내 서로 다른 색상의 구멍이 존재하는 경우, 각 색상 유형별로 최소 1개 이상의 영역을 지정할 것을 권장합니다.

영역 선택을 완료한 후, "Select Hole Region" 버튼(선택 중에는 "Stop Selecting"으로 표시됨)을 다시 클릭하여 선택 모드를 종료합니다. 선택된 영역의 수는 버튼 우측의 상태 레이블에 "N regions" 형태로 표시됩니다.

### 5.4.4 3단계: 그림 영역 선택

"Select Paint Region" 버튼을 클릭하여 그림/글씨 영역 선택 모드를 시작합니다. 버튼이 활성 상태(붉은색 강조)로 전환됩니다. 이미지 위에서 마우스를 드래그하여 그림 또는 글씨가 포함된 영역을 사각형으로 선택합니다. 선택된 영역은 적색 사각형으로 표시됩니다.

구멍 영역 선택과 동일하게, 다수의 영역을 연속적으로 지정할 수 있습니다. 선택을 완료한 후 "Select Paint Region" 버튼(선택 중에는 "Stop Selecting"으로 표시됨)을 다시 클릭하여 선택 모드를 종료합니다.

참고: 구멍 영역 선택 모드에서 그림 영역 선택 모드로 전환하면, 기존의 구멍 영역 선택 모드는 자동으로 종료됩니다. 반대의 경우도 동일합니다.

### 5.4.5 4단계: 자동 분석 (Auto Analyze)

구멍 영역과 그림 영역이 각각 최소 1개 이상 선택되면, "Auto Analyze" 버튼이 활성화됩니다. 이 버튼을 클릭하면 다음의 처리가 백그라운드 스레드에서 수행됩니다.

1. 선택된 구멍 영역들에서 색상 표본을 추출합니다.
2. 선택된 그림 영역들에서 색상 표본을 추출합니다.
3. 각 클래스(구멍, 그림)에 대해 Gaussian Mixture Model(GMM)을 학습합니다.
4. 학습된 GMM 모델의 각 성분(component)에 대해 평균 벡터와 역공분산 행렬을 산출합니다.

분석이 완료되면 Filter Settings 그룹의 모델 상태 표시가 "Model: GMM (N hole + M paint)"로 갱신되며, 상태 바에 "Analysis complete. GMM model (N+M components) - click Apply Filter" 메시지가 표시됩니다.

### 5.4.6 5단계: 필터 적용 (Apply Filter)

"Filter Settings" 그룹의 "Apply Filter" 버튼을 클릭합니다. 시스템은 학습된 GMM 모델을 기반으로 이미지의 모든 픽셀에 대해 Mahalanobis 거리를 산출하고, 구멍 클래스에 가까운 픽셀을 손상 부위로 분류합니다. 이 처리는 백그라운드 스레드에서 수행되며, 로딩 오버레이와 진행률(%)이 표시됩니다.

검출이 완료되면 SVGOverlayViewer에 검출된 각 손상 부위의 윤곽선이 SVG 벡터로 오버레이되며, 각 조각에 공간 기반 번호가 부여됩니다. 상태 바에 "Detected N holes | Active: N" 메시지가 표시됩니다.

### 5.4.7 6단계: 결과 확인

Detection 탭에서 검출 결과를 시각적으로 확인합니다. 필요에 따라 제5.6절의 면적 필터링, 제5.7절의 인터랙티브 조각 관리 기능을 활용하여 검출 결과를 정제합니다.

---

## 5.5 수동 필터 워크플로우

### 5.5.1 개요

현재 버전의 시스템에서는 기존의 채널별 수동 필터(S, L, b, Tex, W 등)가 제거되었으며, Mahalanobis 거리 기반 분류가 이를 대체합니다. 따라서 수동 필터 워크플로우는 자동 필터 워크플로우의 일부 단계를 생략하는 형태로 운용됩니다.

### 5.5.2 FilterPanel 구성

FilterPanel은 다음의 두 요소로 구성됩니다.

1. **모델 상태 표시**: GMM 모델의 학습 여부를 표시합니다. "Model: Not trained"(미학습, 회색), "Model: Ready (Mahalanobis)"(단일 성분 모델, 녹색), "Model: GMM (N hole + M paint)"(다중 성분 모델, 녹색)의 세 가지 상태가 존재합니다.
2. **Apply Filter 버튼**: 현재 설정된 모델 및 면적 필터를 기반으로 검출을 실행합니다.

### 5.5.3 면적 필터와의 조합

FilterPanel 자체에는 채널별 임계값 설정이 존재하지 않으나, Noise Filter(AreaSelector)의 Min Area, Max Area, Boundary Detection 설정은 Apply Filter 실행 시 함께 적용됩니다. 따라서 면적 필터 값을 조정한 후 Apply Filter를 재실행하는 방식으로 결과를 정제할 수 있습니다.

---

## 5.6 면적 필터링 (Noise Filter)

### 5.6.1 개요

좌측 ControlPanel의 "Noise Filter" 그룹은 검출된 손상 부위의 면적에 기반한 노이즈 제거 기능을 제공합니다.

### 5.6.2 최소 면적 (Min Area)

Min 스핀박스에 최소 면적 값을 픽셀 제곱(px^2) 단위로 입력합니다. 이 값보다 작은 면적의 검출 결과는 노이즈로 간주되어 필터링됩니다. 기본값은 100 px^2이며, 설정 범위는 0 ~ 1,000,000 px^2입니다. 단계 값(step)은 100입니다.

### 5.6.3 최대 면적 (Max Area)

Max 스핀박스에 최대 면적 값을 픽셀 제곱(px^2) 단위로 입력합니다. 이 값보다 큰 면적의 검출 결과는 필터링됩니다. 기본값은 500,000 px^2이며, 설정 범위는 100 ~ 10,000,000 px^2입니다. 단계 값(step)은 1,000입니다.

### 5.6.4 시각적 면적 선택

스핀박스에 수치를 직접 입력하는 대신, 이미지 위에서 드래그하여 참조 면적을 설정할 수 있습니다.

Min 또는 Max 스핀박스 우측의 사각형 버튼("Select" 기능)을 클릭하면 해당 면적 선택 모드가 활성화됩니다. 이미지 위에서 마우스를 드래그하여 사각형 영역을 지정하면, 해당 영역의 면적(가로 x 세로, 픽셀 단위)이 자동으로 계산되어 스핀박스에 반영됩니다. Min Area 선택 시 파란색(blue) 사각형이, Max Area 선택 시 주황색(orange) 사각형이 표시됩니다.

### 5.6.5 경계 검출 (Boundary Detection)

"Boundary Detection (Box)" 체크박스는 검출된 손상 부위에 대한 바운딩 박스 피팅 기능의 활성/비활성을 제어합니다. 기본값은 활성(체크) 상태입니다.

### 5.6.6 영역 일괄 해제 (Deselect Area)

"Deselect" 행의 "Drag Area" 버튼을 클릭하면 영역 해제 모드가 활성화됩니다. 이미지 위에서 마우스를 드래그하여 사각형 영역을 지정하면, 해당 영역 내에 완전히 포함된 모든 활성 조각이 비활성 상태로 전환됩니다. 영역 해제 모드를 종료하려면 동일한 버튼을 다시 클릭합니다(토글 방식). 상태 바에 "Deselected N holes | Active: M/T" 메시지가 표시됩니다.

---

## 5.7 인터랙티브 조각 관리

### 5.7.1 조각 활성/비활성 토글

Detection 탭에서 검출된 개별 손상 부위(조각)를 마우스로 클릭하면 해당 조각의 활성 상태가 토글됩니다.

| 상태 | 윤곽선 색상 | 설명 |
|------|------------|------|
| 활성(Active) | 녹색 | 레이아웃 및 저장 대상에 포함됩니다 |
| 비활성(Inactive) | 적색 | 레이아웃 및 저장 대상에서 제외됩니다 |

상태 전환 시 상태 바 및 ControlPanel의 Status 표시가 즉시 갱신됩니다.

### 5.7.2 영역 일괄 해제

제5.6.6절에서 기술한 Deselect Area 기능을 활용하여 특정 영역 내의 다수 조각을 일괄적으로 비활성화할 수 있습니다. 해당 영역 내에 바운딩 박스가 완전히 포함된 조각만 비활성화 대상이 됩니다.

### 5.7.3 조각 검색 (Find Piece)

Detection 탭 상단의 검색 바에서 조각 번호를 검색할 수 있습니다.

1. "Find piece:" 우측의 입력란에 조각 번호(정수)를 입력합니다.
2. "Go" 버튼을 클릭하거나 Enter 키를 누릅니다.
3. 해당 번호의 조각이 존재하면, SVGOverlayViewer가 해당 조각 위치로 자동 이동 및 확대(zoom)하며, 해당 조각에 점멸 효과(flash effect)가 적용되어 시각적으로 강조됩니다.
4. 해당 번호의 조각이 존재하지 않으면, 상태 바에 "Piece #N not found. Available: min - max" 메시지가 표시됩니다.

Layout 탭이 선택된 상태에서 검색을 수행하면 자동으로 Detection 탭으로 전환됩니다.

### 5.7.4 재번호 부여 (Re-number)

검출 결과에서 일부 조각을 비활성화한 후, 활성 조각에 대해 번호를 재부여할 수 있습니다.

1. Detection 탭 상단의 "Re-number" 버튼을 클릭합니다.
2. 시스템은 현재 활성 상태인 조각들만을 대상으로, 좌상단에서 우하단 방향(left-to-right, top-to-bottom)의 그리드 기반 공간 정렬을 수행하여 1번부터 연속 번호를 재부여합니다.
3. 재번호 부여 후 SVGOverlayViewer 및 Layout 탭의 표시가 갱신됩니다.
4. 상태 바에 "Re-numbered N active holes (1 ~ N)" 메시지가 표시됩니다.

### 5.7.5 화면 맞춤 (Fit)

Detection 탭 상단의 "Fit" 버튼을 클릭하면 이미지가 현재 뷰어 영역에 맞게 자동 축소/확대됩니다. View 메뉴의 Fit to Window(Ctrl+0)와 동일한 기능입니다.

---

## 5.8 Layout 탭

### 5.8.1 개요

Layout 탭은 검출된 활성 조각들을 지정된 용지 크기 위에 자동으로 배치(Bin Packing)한 결과를 미리보기하고, 용지 크기, 스케일, 여백 등의 레이아웃 매개변수를 조정하는 기능을 제공합니다. Detection 탭에서 Layout 탭으로 전환하면 현재 활성 조각들의 레이아웃이 자동으로 생성됩니다.

### 5.8.2 용지 크기 프리셋

상단 컨트롤 영역의 "Paper:" 콤보박스에서 용지 크기 프리셋을 선택할 수 있습니다.

| 프리셋 | 너비(mm) | 높이(mm) |
|--------|----------|----------|
| Custom | 100 | 290 |
| A4 | 210 | 297 |
| A3 | 297 | 420 |
| A2 | 420 | 594 |
| B4 | 250 | 353 |
| B3 | 353 | 500 |

프리셋을 선택하면 너비(W) 및 높이(H) 스핀박스의 값이 자동으로 갱신됩니다. "Custom"을 선택한 경우 너비와 높이를 직접 입력할 수 있습니다.

### 5.8.3 너비 및 높이

"W:" 및 "H:" 스핀박스에 용지의 너비와 높이를 밀리미터(mm) 단위로 입력합니다. 설정 범위는 각각 50 ~ 2,000 mm입니다. 값을 변경하면 300ms 디바운스 후 레이아웃이 자동으로 재생성됩니다.

### 5.8.4 여백 (Margin)

Margin 스핀박스에 용지 가장자리 여백을 밀리미터(mm) 단위로 입력합니다. 설정 범위는 0 ~ 50 mm이며, 기본값은 2 mm입니다.

### 5.8.5 스케일 (Scale)

"Scale:" 스핀박스에 스케일 팩터를 입력합니다. 이 값은 픽셀을 밀리미터로 변환하는 비율(mm/pixel)을 의미합니다. 설정 범위는 0.001 ~ 1.0이며, 소수점 4자리까지 표시됩니다. 단계 값(step)은 0.0001입니다.

참조 조각이 설정되지 않은 경우, 시스템은 모든 조각이 용지에 수용될 수 있도록 스케일을 자동으로 조정합니다. 특정 조각이 선택된 상태에서 스케일을 변경하면 선택된 조각에만 개별 스케일이 적용됩니다.

### 5.8.6 테두리 두께 (Border)

"Border:" 스핀박스에 레이아웃 내 각 조각의 윤곽선 두께를 밀리미터(mm) 단위로 입력합니다. 설정 범위는 0.5 ~ 5.0 mm이며, 기본값은 1.0 mm입니다. 단계 값(step)은 0.5입니다.

### 5.8.7 조각 간격 (Spacing)

"Spacing:" 스핀박스에 조각 간의 간격을 밀리미터(mm) 단위로 입력합니다. 설정 범위는 0.5 ~ 3.0 mm이며, 기본값은 1.5 mm입니다. 단계 값(step)은 0.1입니다.

### 5.8.8 라벨 크기 및 간격

"Label:" 스핀박스에 SVG 내보내기 시 조각 번호 라벨의 글자 크기를 밀리미터(mm) 단위로 입력합니다. 설정 범위는 0.2 ~ 5.0 mm이며, 기본값은 1.6 mm입니다.

"Gap:" 스핀박스에 라벨과 조각 사이의 간격을 밀리미터(mm) 단위로 입력합니다. 설정 범위는 0.0 ~ 3.0 mm이며, 기본값은 0.6 mm입니다.

### 5.8.9 페이지 네비게이션

활성 조각의 수가 단일 페이지에 수용 가능한 양을 초과하는 경우, 시스템은 자동으로 다수의 페이지를 생성합니다. 페이지당 최대 100개의 조각이 배치됩니다.

페이지 표시줄에 "Page N/T" 형태로 현재 페이지 번호와 전체 페이지 수가 표시됩니다. 좌측 "◄" 버튼으로 이전 페이지로, 우측 "►" 버튼으로 다음 페이지로 이동할 수 있습니다. 첫 페이지에서는 이전 버튼이, 마지막 페이지에서는 다음 버튼이 비활성화됩니다.

용지 크기를 초과하여 배치할 수 없는 조각이 존재하는 경우, 페이지 표시줄에 해당 수량이 경고 메시지로 표시됩니다.

### 5.8.10 실측 캘리브레이션

레이아웃 내 조각의 실제 물리적 크기를 설정하여 스케일을 캘리브레이션할 수 있습니다.

1. 레이아웃 뷰어에서 기준이 될 조각 하나를 클릭하여 선택합니다(선택된 조각은 파란색 테두리로 강조됩니다).
2. 하단 컨트롤 영역의 "Real:" 섹션에서 "W:" 및 "H:" 스핀박스에 해당 조각의 실제 너비와 높이를 센티미터(cm) 단위로 입력합니다. 설정 범위는 각각 0.1 ~ 100.0 cm이며, 소수점 2자리까지 입력 가능합니다.
3. "Apply" 버튼을 클릭합니다.
4. 시스템은 입력된 실측값과 해당 조각의 픽셀 치수를 기반으로 스케일 팩터(mm/pixel)를 자동으로 산출하고, 전체 레이아웃에 적용합니다.

참고: "Apply" 버튼은 정확히 1개의 조각이 선택된 경우에만 활성화됩니다. 조각 선택 시 현재 스케일에 기반한 추정 실측값이 "W:"/"H:" 스핀박스에 자동으로 채워집니다.

### 5.8.11 배치 실패 조각

용지 크기 및 스케일 설정에 따라 일부 조각이 용지에 수용되지 못하는 경우, 해당 조각은 "배치 실패(failed)" 상태로 분류됩니다. 이 경우 다음의 정보가 표시됩니다.

- 페이지 표시줄에 "N failed" 경고 메시지가 적색으로 표시됩니다.
- 레이아웃 상단 좌측에 "N pcs (total: T) | N FAILED" 텍스트가 적색으로 표시됩니다.

배치 실패를 해소하려면 다음 조치를 고려합니다.

- 더 큰 용지 크기를 사용합니다.
- 스케일 팩터를 축소합니다.
- 여백 또는 간격을 감소시킵니다.

---

## 5.9 결과 저장

### 5.9.1 저장 실행

다음의 방법 중 하나로 결과 저장을 실행합니다.

- 좌측 ControlPanel의 "Save Results" 버튼을 클릭합니다.
- 메뉴 바의 File > Save All Results를 선택합니다.
- 키보드 단축키 Ctrl+S를 누릅니다.

검출 결과가 존재하지 않는 경우 경고 대화상자가 표시됩니다.

### 5.9.2 출력 폴더 선택

저장 실행 시 폴더 선택 대화상자가 나타납니다. 결과 파일이 저장될 출력 폴더를 선택합니다.

### 5.9.3 출력 디렉토리 구조

선택된 출력 폴더 내에 다음의 하위 디렉토리가 자동으로 생성됩니다.

```
[출력 폴더]/
|-- info.json                          메타데이터 (JSON)
|
|-- detection/                         검출 결과
|   |-- mask.png                       이진 마스크 이미지
|   |-- comparison.png                 원본 위 윤곽선 오버레이 이미지
|   +-- svg_vectors/                   개별 조각 SVG 벡터 파일
|       |-- hole_001.svg
|       |-- hole_002.svg
|       +-- ...
|
|-- cutting_layout/                    커팅 레이아웃
|   |-- layout_page_01.png            레이아웃 페이지 이미지 (300 DPI)
|   |-- layout_page_01.svg            레이아웃 페이지 SVG (벡터)
|   +-- ...                           (다수 페이지인 경우 연속 번호)
|
+-- restoration_guide/                 복원 가이드
    +-- restoration_guide.png          번호 오버레이 가이드 이미지
```

### 5.9.4 출력 파일 상세

**detection/mask.png**: 검출된 손상 부위를 흰색(255), 배경을 검은색(0)으로 표현한 이진 마스크 이미지입니다.

**detection/comparison.png**: 원본 이미지 위에 활성 조각의 윤곽선을 오버레이한 비교 이미지입니다.

**detection/svg_vectors/hole_NNN.svg**: 각 활성 조각의 윤곽선을 개별 SVG 벡터 파일로 출력한 것입니다. SVG의 width/height 속성에는 밀리미터(mm) 단위의 실측 크기가, viewBox 속성에는 픽셀 단위의 원본 크기가 기록됩니다.

**cutting_layout/layout_page_NN.png**: 레이아웃 페이지를 300 DPI 해상도의 PNG 이미지로 출력한 것입니다.

**cutting_layout/layout_page_NN.svg**: 레이아웃 페이지를 SVG 벡터 파일로 출력한 것입니다. Adobe Illustrator, Adobe Photoshop 등의 벡터 편집 소프트웨어에서 편집 가능하며, 레이저 커터에 직접 입력 가능한 형식입니다.

**restoration_guide/restoration_guide.png**: 원본 이미지 위에 각 활성 조각의 윤곽선(시안색)과 번호를 오버레이한 복원 가이드 이미지입니다. 커팅 레이아웃의 조각 번호와 원본 작품의 해당 위치가 1:1로 대응됩니다.

**info.json**: 검출 매개변수, 용지 크기, 여백, 페이지 수, 스케일 팩터, 각 조각의 레이아웃 좌표, 배치 실패 조각 목록 등의 메타데이터를 JSON 형식으로 기록한 파일입니다.

### 5.9.5 배치 실패 경고

저장 완료 시 배치 실패 조각이 존재하는 경우, 경고 대화상자에 실패한 조각의 번호 목록과 함께 용지 크기 변경, 스케일 축소, 여백/간격 감소 등의 해결 방안이 제시됩니다.

---

## 5.10 세션 관리

### 5.10.1 개요

본 시스템은 현재 작업 상태를 JSON 형식의 세션 파일(.session.json)로 저장하고 복원하는 기능을 제공합니다. 이를 통해 장시간 소요되는 작업을 중단한 후 이어서 수행하거나, 동일한 설정을 반복 적용할 수 있습니다.

### 5.10.2 세션 저장

다음의 방법으로 세션을 저장합니다.

- 메뉴 바의 File > Save Session을 선택합니다.
- 키보드 단축키 Ctrl+Shift+S를 누릅니다.

파일 저장 대화상자가 나타나며, 확장자 .session.json으로 세션 파일을 저장합니다. 이미지가 로드되지 않은 상태에서는 저장이 불가하며, 경고 대화상자가 표시됩니다.

### 5.10.3 세션에 포함되는 데이터

세션 파일에는 다음의 데이터가 포함됩니다.

| 항목 | 설명 |
|------|------|
| version | 세션 파일 형식 버전 (현재 v3)입니다 |
| image_path | 원본 이미지 파일의 절대 경로입니다 |
| holes | 검출된 모든 조각의 데이터 (ID, 바운딩 박스, 면적, 윤곽선 좌표)입니다 |
| svg_paths | 각 조각의 SVG 경로 문자열입니다 |
| active_holes | 활성 상태인 조각의 인덱스 목록입니다 |
| bg_regions | 선택된 구멍 영역 좌표 목록입니다 |
| fg_regions | 선택된 그림 영역 좌표 목록입니다 |
| region_model | 학습된 GMM 모델 (각 성분의 평균, 역공분산, 가중치)입니다 |
| filter_settings | 면적 필터 및 경계 검출 설정입니다 |
| layout | 레이아웃 설정 (용지 크기, 프리셋, 여백, 스케일, 테두리, 간격, 기준 조각, 개별 스케일)입니다 |

### 5.10.4 세션 불러오기

다음의 방법으로 세션을 불러옵니다.

- 메뉴 바의 File > Load Session을 선택합니다.
- 키보드 단축키 Ctrl+Shift+O를 누릅니다.

파일 선택 대화상자에서 .session.json 파일을 선택하면, 다음의 복원 과정이 순차적으로 수행됩니다.

1. 기존 상태를 모두 초기화합니다.
2. 이미지를 로드합니다. 파일이 존재하지 않는 경우 수동으로 이미지 위치를 지정하는 대화상자가 나타납니다.
3. 검출 결과(조각 데이터, SVG 경로)를 복원합니다.
4. 활성/비활성 상태를 복원합니다.
5. GMM 모델을 복원하고 모델 상태 표시를 갱신합니다.
6. 면적 필터 및 경계 검출 설정을 복원합니다.
7. 영역 선택 상태를 복원합니다.
8. 레이아웃 설정(용지 크기, 스케일, 테두리, 간격 등)을 복원하고 레이아웃을 재생성합니다.
9. 개별 스케일이 설정된 조각의 스케일을 복원합니다.

### 5.10.5 버전 호환성

본 시스템은 다음의 세 가지 세션 파일 형식 버전을 지원합니다.

| 버전 | 특징 | 호환성 |
|------|------|--------|
| v1 | 레거시 슬라이더 필터, 단일 영역, 모델 미저장 | 영역 데이터를 리스트로 변환하여 호환됩니다 |
| v2 | 단일 성분 Mahalanobis 모델, 단일 영역 | type='single' 모델로 복원됩니다 |
| v3 | GMM 다중 성분 모델, 다중 영역 리스트 | 현재 버전 (완전 지원)입니다 |

v1 세션을 불러온 경우 모델이 저장되어 있지 않으므로, "Auto Analyze"를 다시 실행하여 모델을 재구축할 것을 권장하는 안내 메시지가 표시됩니다.

---

## 5.11 키보드 단축키

### 5.11.1 단축키 일람표

본 시스템에서 사용 가능한 키보드 단축키는 다음과 같습니다.

| 단축키 | 기능 | 메뉴 경로 |
|--------|------|----------|
| Ctrl+O | 이미지 열기 | File > Open Image |
| Ctrl+S | 결과 저장 | File > Save All Results |
| Ctrl+Shift+S | 세션 저장 | File > Save Session |
| Ctrl+Shift+O | 세션 불러오기 | File > Load Session |
| Ctrl+Q | 애플리케이션 종료 | File > Exit |
| Ctrl++ | 확대 | View > Zoom In |
| Ctrl+- | 축소 | View > Zoom Out |
| Ctrl+0 | 화면 맞춤 | View > Fit to Window |

### 5.11.2 마우스 조작

| 조작 | 대상 영역 | 기능 |
|------|----------|------|
| 마우스 휠 상/하 | Detection 탭 뷰어 | 확대/축소 (마우스 포인터 위치 기준) |
| 마우스 휠 상/하 | Layout 탭 뷰어 | 확대/축소 (마우스 포인터 위치 기준) |
| 좌클릭 | Detection 탭의 조각 | 활성/비활성 토글 |
| 좌클릭 | Layout 탭의 조각 | 선택/선택해제 토글 |
| 좌클릭 드래그 | Detection 탭 (선택 모드) | 영역 선택 (구멍/그림/면적/해제) |
| Enter | 검색 입력란 | 조각 검색 실행 |

### 5.11.3 검색 바 조작

Detection 탭 상단의 검색 바에서 조각 번호를 입력한 후, Enter 키 또는 "Go" 버튼으로 검색을 실행합니다. 검색된 조각 위치로 자동 이동 및 확대가 수행됩니다.
